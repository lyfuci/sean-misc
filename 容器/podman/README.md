# podman 简介
官网: https://podman.io/

podman 是一个没有守护进程的可以用来开发管理运行OCI容器的linux平台的容器引擎，容器可以在root或者rootless模式下运行。

> 看描述跟 docker 最大的直观差别就是没有守护进程了。



# 常用操作
## 配置镜像加速

`man 5 containers-registries.conf`可以查看相关的配置概念

`vi /etc/containers/registries.conf` 进行如下配置


```
# 不是全限定名的时候 使用 docker.io registry
unqualified-search-registries = ["docker.io"]
[[registry]]
# 匹配的前缀
prefix = "docker.io"
# 实际的位置 换成你的 aliyun 镜像加速器或者别的国内源就好了
location = "your.mirror.aliyuncs.com"
```

> 配置完之后除了一些非常有名的镜像，可能还有别名设置，会使用到别的registry里面的镜像，大部分普通镜像都能使用加速器拉取了。<br>
> 如果想不使用别名的配置，可以直接把 `/etc/containers/rhel-shortnames.conf` 后缀改一下就OK了。

## 配置代理
podman 支持读取 http_proxy 和 https_proxy 环境变量来配置代理

## podman 网络模式
podman 的网络模式目前只支持 bridge 模式(2021-08-22), 目测可能不太会趋向于支持更多的网络模式了，更多的是为了不提供冗余功能的作为 k8s 的容器运行时。

## 容器自启动
podman 的容器自启动还挺麻烦的，主要是因为自身不带多余的守护进程对自启动进行维护。
使用 `podman generate` 命令可以直接生成交由 k8s 和 systemd 直接管理的配置文件，下面仅对 systemd 方面的配置文件进行说明

```bash
# 首先运行一个 docker 容器
[root@localhost ~]# podman run -d -p 80:80 -v /home/linger/nginx:/usr/share/nginx/html --name nginx  nginx
# 其实 --files 表示生成文件 --new 表示每次都启用一个新的容器(旧的会自动删除) --name 服务名字用容器名字(有个'container-'开头的前缀)
[root@localhost ~]# podman generate systemd --files --new --name nginx 

[root@localhost ~]# cat container-nginx.service 
# container-nginx.service
# autogenerated by Podman 3.3.0-dev
# Sun Aug 22 11:21:56 CST 2021

[Unit]
Description=Podman container-nginx.service
Documentation=man:podman-generate-systemd(1)
Wants=network-online.target
After=network-online.target
RequiresMountsFor=%t/containers

[Service]
Environment=PODMAN_SYSTEMD_UNIT=%n
Restart=on-failure
TimeoutStopSec=70
ExecStart=/usr/bin/podman run --sdnotify=conmon --cgroups=no-conmon --rm --replace -d -p 80:80 -v /home/linger/nginx:/usr/share/nginx/html --name nginx nginx
Type=notify
NotifyAccess=all

[Install]
WantedBy=multi-user.target default.target
```
然后只需要将`container-nginx.service` 放置到对应的服务启动位置 `systemctl daemon-reload` ，即可尝试 `reboot` 查看是否会重启

非跟用户放置的位置应该是 `$HOME/.config/systemd/user` 目录下。